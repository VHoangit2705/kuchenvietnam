<?php
// Káº¿t ná»‘i database
include'../config.php';
// Kiá»ƒm tra káº¿t ná»‘i
if ($conn->connect_error) {
    die("Káº¿t ná»‘i tháº¥t báº¡i: " . $conn->connect_error);
}

// Kiá»ƒm tra tham sá»‘ Ä‘Æ¡n hÃ ng trÃªn URL
if (!isset($_GET['id'])) {
    die("MÃ£ hÃ³a Ä‘Æ¡n hÃ ng khÃ´ng Ä‘Æ°á»£c khá»Ÿi táº¡o Ä‘Ãºng.");
}

$orderId = $_GET['id'];
$nv = isset($_GET['nv']) ? $_GET['nv'] : "1";

// Truy váº¥n láº¥y order_code2 tá»« báº£ng orders
$sql = "SELECT order_code2 FROM orders WHERE id = ?";
$stmt = $conn->prepare($sql);
$stmt->bind_param("i", $orderId);
$stmt->execute();
$result = $stmt->get_result();

if ($row = $result->fetch_assoc()) {
    $orderCode2 = $row['order_code2'];
} else {
    die("KhÃ´ng tÃ¬m tháº¥y Ä‘Æ¡n hÃ ng vá»›i ID: " . htmlspecialchars($orderId));
}
$stmt->close();

// Truy váº¥n láº¥y thÃ´ng tin nhÃ¢n viÃªn giao hÃ ng tá»« báº£ng users
$sql = "SELECT full_name,sdt FROM users WHERE id = ?";
$stmt = $conn->prepare($sql);
$stmt->bind_param("i", $nv);
$stmt->execute();
$result = $stmt->get_result();

if ($row = $result->fetch_assoc()) {
    $nvName = $row['full_name'];
    $nvPhone = $row['sdt'];
} else {
    $nvName = "KhÃ´ng xÃ¡c Ä‘á»‹nh";
    $nvPhone = "N/A";
}

// ÄÃ³ng káº¿t ná»‘i
$stmt->close();
$conn->close();
?>
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ÄÃ¡nh giÃ¡ Ä‘Æ¡n hÃ ng</title>
  <!-- Bootstrap 4 CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome 5 -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
  <style>
    /* Reset margin, padding cho body */
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background-color: #f7f7f7;
    }
    
    /* Header */
    .header {
      background-color: orange;
      color: white;
      padding: 15px 20px;
      position: relative;
      text-align: center;
    }
    .header .logo {
      max-height: 50px;
      width: auto;
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
    }
    .header .title {
      font-size: 22px;
      font-weight: bold;
      margin: 0;
      line-height: 1.2;
    }
    
    /* Ná»™i dung chÃ­nh */
    .main-content {
      padding: 20px;
      padding-bottom: 100px; /* táº¡o khoáº£ng cÃ¡ch cho footer cá»‘ Ä‘á»‹nh */
    }
    .section-title {
      text-align: center;
      margin-bottom: 20px;
      font-size: 18px;
      font-weight: 500;
    }
    
    /* Form Ä‘Ã¡nh giÃ¡ */
    .criteria-row {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
      align-items: center;
      cursor: pointer;
    }
    .criteria-label {
      font-size: 16px;
      font-weight: bold;
    }
    .icon-set {
      display: flex;
      justify-content: space-around;
    }
    /* CÃ¡c icon vÃ  text bÃªn trong icon-set */
    .icon-set i, .icon-set span {
      font-size: 20px;
      cursor: pointer;
      transition: transform 0.2s, background-color 0.2s;
      padding: 5px;
      border-radius: 5px;
    }
    .icon-set i:hover, .icon-set span:hover {
      transform: scale(1.2);
    }
    /* Lá»›p hiá»‡u á»©ng chá»n: ná»n mÃ u cam nháº¡t */
    .selected-icon {
      background-color: #ffd699;
    }
    
    /* Footer */
    .footer {
      background-color: orange;
      color: white;
      text-align: center;
      padding: 10px 0;
      position: fixed;
      left: 0;
      bottom: 0;
      width: 100%;
      font-size: 14px;
    }
    
    /* Responsive: hiá»ƒn thá»‹ theo cá»™t khi mÃ n hÃ¬nh nhá» */
    @media (max-width: 576px) {
      .criteria-row {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
      }
      .icon-set {
        width: 100%;
        justify-content: space-around;
        margin-top: 10px;
      }
      .criteria-label {
        font-size: 15px;
      }
      .icon-set i, .icon-set span {
        font-size: 26px;
      }
      .header {
        position: static;
        padding: 15px;
      }
      .header .logo {
        position: static;
        transform: none;
        margin-bottom: 10px;
      }
      .header .title {
        text-align: center;
      }
    }
  </style>
</head>
<body>
  
  <!-- Header -->
  <header class="header">
    <img src="logokuchen.png" alt="Logo CÃ´ng ty" class="logo">
    <h1 class="title">ÄÃNH GIÃ Dá»ŠCH Vá»¤ ÄÆ N HÃ€NG MÃƒ Sá»: <?php echo htmlspecialchars($orderCode2); ?></h1>
  </header>
  
  <!-- Ná»™i dung chÃ­nh -->
  <main class="main-content container">
    <h5 class="section-title">Phiáº¿u Ä‘Ã¡nh giÃ¡ sá»± hÃ i lÃ²ng cá»§a khÃ¡ch hÃ ng Ä‘á»‘i vá»›i nhÃ¢n viÃªn giao hÃ ng</h5>
    <!-- Form gá»­i dá»¯ liá»‡u qua POST; truyá»n mÃ£ Ä‘Æ¡n qua URL -->
    <form method="post" action="save_evaluation.php?id=<?php echo urlencode($orderId); ?>&nv=<?php echo urlencode($nv); ?>">
      
      <!-- TiÃªu chÃ­ 1: ThÃ¡i Ä‘á»™ vÃ  sá»± chuyÃªn nghiá»‡p -->
      <div class="row criteria-row" data-target="#criteria1">
        <div class="col-12 col-md-8">
          <span class="criteria-label">
            <a class="d-block" data-toggle="collapse" href="#criteria1" role="button" 
               aria-expanded="false" aria-controls="criteria1" style="color: inherit; text-decoration: none;">
              ğŸ‘‰ ThÃ¡i Ä‘á»™ vÃ  sá»± chuyÃªn nghiá»‡p cá»§a nhÃ¢n viÃªn vá»›i báº¡n (nháº¥n Ä‘á»ƒ xem tiÃªu chÃ­)
            </a>
          </span>
          <div class="collapse" id="criteria1">
            <ul class="list-unstyled mt-2">
              <li>- NhÃ¢n viÃªn cÃ³ ná»Ÿ ná»¥ cÆ°á»i vÃ  thá»ƒ hiá»‡n thÃ¡i Ä‘á»™ thÃ¢n thiá»‡n khi giao hÃ ng.</li>
              <li>- ÄÃ¡p á»©ng cÃ¡c yÃªu cáº§u cá»§a khÃ¡ch hÃ ng má»™t cÃ¡ch nhanh chÃ³ng vÃ  nhiá»‡t tÃ¬nh.</li>
              <li>- Giá»¯ thÃ¡i Ä‘á»™ kiÃªn nháº«n, lá»‹ch sá»± trong cÃ¡c tÃ¬nh huá»‘ng khÃ³ khÄƒn hoáº·c cÄƒng tháº³ng.</li>
            </ul>
          </div>
          <!-- Hidden input Ä‘á»ƒ lÆ°u giÃ¡ trá»‹ Ä‘Ã¡nh giÃ¡ cho tiÃªu chÃ­ 1 -->
          <input type="hidden" name="tc1" id="tc1" value="">
        </div>
        <div class="col-12 col-md-4">
          <div class="icon-set text-center">
            <!-- ThÃªm Ä‘á»‘i sá»‘ "this" vÃ o hÃ m setRating -->
            <div style="display: inline-block; margin: 10px;" onclick="setRating('tc1','HÃ i lÃ²ng', this);">
              <span style="font-size: 24px;">ğŸ˜</span><br>
              <span>HÃ i lÃ²ng</span>
            </div>
            <div style="display: inline-block; margin: 10px;" onclick="setRating('tc1','BÃ¬nh thÆ°á»ng', this);">
              <span style="font-size: 24px;">ğŸ™‚</span><br>
              <span>BÃ¬nh thÆ°á»ng</span>
            </div>
            <div style="display: inline-block; margin: 10px;" onclick="setRating('tc1','KhÃ´ng hÃ i lÃ²ng', this);">
              <span style="font-size: 24px;">ğŸ˜</span><br>
              <span>KhÃ´ng hÃ i lÃ²ng</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- TiÃªu chÃ­ 2: ÄÃºng giá» vÃ  tuÃ¢n thá»§ thá»i gian giao hÃ ng -->
      <div class="row criteria-row" data-target="#criteria2">
        <div class="col-12 col-md-8">
          <span class="criteria-label">
            <a class="d-block" data-toggle="collapse" href="#criteria2" role="button" 
               aria-expanded="false" aria-controls="criteria2" style="color: inherit; text-decoration: none;">
              ğŸ‘‰ ÄÃºng giá» vÃ  tuÃ¢n thá»§ thá»i gian giao hÃ ng (nháº¥n Ä‘á»ƒ xem tiÃªu chÃ­)
            </a>
          </span>
          <div class="collapse" id="criteria2">
            <ul class="list-unstyled mt-2">
              <li>- NhÃ¢n viÃªn giao hÃ ng Ä‘áº¿n Ä‘Ãºng thá»i gian Ä‘Ã£ thÃ´ng bÃ¡o.</li>
              <li>- Náº¿u cÃ³ sá»± cá»‘ vá» thá»i gian giao hÃ ng (nhÆ° giao trá»…), nhÃ¢n viÃªn cÃ³ thÃ´ng bÃ¡o cho khÃ¡ch hÃ ng trÆ°á»›c khÃ´ng?</li>
            </ul>
          </div>
          <input type="hidden" name="tc2" id="tc2" value="">
        </div>
        <div class="col-12 col-md-4">
          <div class="icon-set text-center">
            <div style="display: inline-block; margin: 10px;" onclick="setRating('tc2','HÃ i lÃ²ng', this);">
              <span style="font-size: 24px;">ğŸ˜</span><br>
              <span>HÃ i lÃ²ng</span>
            </div>
            <div style="display: inline-block; margin: 10px;" onclick="setRating('tc2','BÃ¬nh thÆ°á»ng', this);">
              <span style="font-size: 24px;">ğŸ™‚</span><br>
              <span>BÃ¬nh thÆ°á»ng</span>
            </div>
            <div style="display: inline-block; margin: 10px;" onclick="setRating('tc2','KhÃ´ng hÃ i lÃ²ng', this);">
              <span style="font-size: 24px;">ğŸ˜</span><br>
              <span>KhÃ´ng hÃ i lÃ²ng</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- TiÃªu chÃ­ 3: CÃ¡ch thá»©c giao hÃ ng vÃ  báº£o quáº£n hÃ ng hÃ³a -->
      <div class="row criteria-row" data-target="#criteria3">
        <div class="col-12 col-md-8">
          <span class="criteria-label">
            <a class="d-block" data-toggle="collapse" href="#criteria3" role="button" 
               aria-expanded="false" aria-controls="criteria3" style="color: inherit; text-decoration: none;">
              ğŸ‘‰ CÃ¡ch thá»©c giao hÃ ng vÃ  báº£o quáº£n hÃ ng hÃ³a (nháº¥n Ä‘á»ƒ xem tiÃªu chÃ­)
            </a>
          </span>
          <div class="collapse" id="criteria3">
            <ul class="list-unstyled mt-2">
              <li>- HÃ ng hÃ³a Ä‘Æ°á»£c giao nguyÃªn váº¹n, khÃ´ng bá»‹ hÆ° háº¡i, mÃ³p mÃ©o hoáº·c vá»¡.</li>
              <li>- HÃ ng hÃ³a Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i, bá»c che cháº¯n, cá»™t cháº¯c cháº¯n trÃªn giÃ¡ giao hÃ ng khi giao Ä‘áº¿n, v.v.</li>
              <li>- CÃ¡ch thá»©c giao hÃ ng cÃ³ nhanh chÃ³ng, chÃ­nh xÃ¡c khÃ´ng (khÃ´ng lÃ m khÃ¡ch hÃ ng pháº£i Ä‘á»£i lÃ¢u).</li>
            </ul>
          </div>
          <input type="hidden" name="tc3" id="tc3" value="">
        </div>
        <div class="col-12 col-md-4">
          <div class="icon-set text-center">
            <div style="display: inline-block; margin: 10px;" onclick="setRating('tc3','HÃ i lÃ²ng', this);">
              <span style="font-size: 24px;">ğŸ˜</span><br>
              <span>HÃ i lÃ²ng</span>
            </div>
            <div style="display: inline-block; margin: 10px;" onclick="setRating('tc3','BÃ¬nh thÆ°á»ng', this);">
              <span style="font-size: 24px;">ğŸ™‚</span><br>
              <span>BÃ¬nh thÆ°á»ng</span>
            </div>
            <div style="display: inline-block; margin: 10px;" onclick="setRating('tc3','KhÃ´ng hÃ i lÃ²ng', this);">
              <span style="font-size: 24px;">ğŸ˜</span><br>
              <span>KhÃ´ng hÃ i lÃ²ng</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- TiÃªu chÃ­ 4: Äáº£m báº£o sá»± an toÃ n cá»§a hÃ ng hÃ³a -->
      <div class="row criteria-row" data-target="#criteria4">
        <div class="col-12 col-md-8">
          <span class="criteria-label">
            <a class="d-block" data-toggle="collapse" href="#criteria4" role="button" 
               aria-expanded="false" aria-controls="criteria4" style="color: inherit; text-decoration: none;">
              ğŸ‘‰ Äáº£m báº£o sá»± an toÃ n cá»§a hÃ ng hÃ³a (nháº¥n Ä‘á»ƒ xem tiÃªu chÃ­)
            </a>
          </span>
          <div class="collapse" id="criteria4">
            <ul class="list-unstyled mt-2">
              <li>- HÃ ng hÃ³a Ä‘Æ°á»£c giao Ä‘áº¿n tay khÃ¡ch khÃ´ng bá»‹ thiáº¿u, máº¥t hoáº·c bá»‹ má»Ÿ hÃ ng trÆ°á»›c trong suá»‘t quÃ¡ trÃ¬nh giao.</li>
            </ul>
          </div>
          <input type="hidden" name="tc4" id="tc4" value="">
        </div>
        <div class="col-12 col-md-4">
          <div class="icon-set text-center">
            <div style="display: inline-block; margin: 10px;" onclick="setRating('tc4','HÃ i lÃ²ng', this);">
              <span style="font-size: 24px;">ğŸ˜</span><br>
              <span>HÃ i lÃ²ng</span>
            </div>
            <div style="display: inline-block; margin: 10px;" onclick="setRating('tc4','BÃ¬nh thÆ°á»ng', this);">
              <span style="font-size: 24px;">ğŸ™‚</span><br>
              <span>BÃ¬nh thÆ°á»ng</span>
            </div>
            <div style="display: inline-block; margin: 10px;" onclick="setRating('tc4','KhÃ´ng hÃ i lÃ²ng', this);">
              <span style="font-size: 24px;">ğŸ˜</span><br>
              <span>KhÃ´ng hÃ i lÃ²ng</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- TiÃªu chÃ­ 5: Sá»± minh báº¡ch vÃ  rÃµ rÃ ng trong giao tiáº¿p -->
      <div class="row criteria-row" data-target="#criteria5">
        <div class="col-12 col-md-8">
          <span class="criteria-label">
            <a class="d-block" data-toggle="collapse" href="#criteria5" role="button" 
               aria-expanded="false" aria-controls="criteria5" style="color: inherit; text-decoration: none;">
              ğŸ‘‰ Sá»± minh báº¡ch vÃ  rÃµ rÃ ng trong giao tiáº¿p cá»§a nhÃ¢n viÃªn vá»›i báº¡n (nháº¥n Ä‘á»ƒ xem tiÃªu chÃ­)
            </a>
          </span>
          <div class="collapse" id="criteria5">
            <ul class="list-unstyled mt-2">
              <li>- NhÃ¢n viÃªn giao hÃ ng cÃ³ cung cáº¥p thÃ´ng tin Ä‘áº§y Ä‘á»§ vá» Ä‘Æ¡n hÃ ng cho khÃ¡ch (mÃ£ Ä‘Æ¡n hÃ ng, tÃªn sáº£n pháº©m, sá»‘ tiá»n thu há»™ náº¿u cÃ³, v.v.).</li>
              <li>- Giáº£i thÃ­ch rÃµ rÃ ng vÃ  minh báº¡ch vá» cÃ¡c yÃªu cáº§u cá»§a khÃ¡ch hÃ ng (VD: YÃªu cáº§u kÃ½ xÃ¡c nháº­n giao hÃ ng, tráº£ tiá»n, v.v.).</li>
              <li>- NhÃ¢n viÃªn giáº£i quyáº¿t cÃ¡c váº¥n Ä‘á» phÃ¡t sinh má»™t cÃ¡ch hiá»‡u quáº£.</li>
            </ul>
          </div>
          <input type="hidden" name="tc5" id="tc5" value="">
        </div>
        <div class="col-12 col-md-4">
          <div class="icon-set text-center">
            <div style="display: inline-block; margin: 10px;" onclick="setRating('tc5','HÃ i lÃ²ng', this);">
              <span style="font-size: 24px;">ğŸ˜</span><br>
              <span>HÃ i lÃ²ng</span>
            </div>
            <div style="display: inline-block; margin: 10px;" onclick="setRating('tc5','BÃ¬nh thÆ°á»ng', this);">
              <span style="font-size: 24px;">ğŸ™‚</span><br>
              <span>BÃ¬nh thÆ°á»ng</span>
            </div>
            <div style="display: inline-block; margin: 10px;" onclick="setRating('tc5','KhÃ´ng hÃ i lÃ²ng', this);">
              <span style="font-size: 24px;">ğŸ˜</span><br>
              <span>KhÃ´ng hÃ i lÃ²ng</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Ã” Ä‘Ã³ng gÃ³p Ã½ kiáº¿n chung -->
      <div class="form-group mt-4">
        <label for="userFeedback"><strong>ThÃªm Ã½ kiáº¿n gÃ³p Ã½ cho KUCHEN:</strong></label>
        <textarea class="form-control" id="userFeedback" name="userFeedback" rows="4" placeholder="Nháº­p Ã½ kiáº¿n Ä‘Ã³ng gÃ³p cá»§a báº¡n táº¡i Ä‘Ã¢y..."></textarea>
      </div>
      
      <div class="text-center mt-4">
        <button type="submit" class="btn btn-primary btn-block btn-lg">Gá»­i Ä‘Ã¡nh giÃ¡</button>
      </div>
    </form>
  </main>
  
  <!-- Footer -->
  <footer class="footer">
    <h4>NhÃ¢n viÃªn giao hÃ ng: <?php echo htmlspecialchars($nvName); ?> - SÄT: <?php echo htmlspecialchars($nvPhone); ?></h4>
</footer>
  
  <!-- jQuery, Popper.js vÃ  Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    // Khi click vÃ o báº¥t ká»³ vá»‹ trÃ­ nÃ o trong criteria-row (trá»« khu vá»±c icon), toggle collapse cá»§a pháº§n mÃ´ táº£
    document.querySelectorAll('.criteria-row').forEach(function(row) {
      row.addEventListener('click', function(e) {
        if (e.target.closest('.icon-set')) return;
        var collapseEl = row.querySelector('.collapse');
        if(collapseEl){
          $(collapseEl).collapse('toggle');
        }
      });
    });
    
    // HÃ m setRating: cáº­p nháº­t giÃ¡ trá»‹ cho input hidden vÃ  thÃªm hiá»‡u á»©ng ná»•i mÃ u cam nháº¡t cho icon Ä‘Æ°á»£c chá»n
    function setRating(field, value, element) {
      document.getElementById(field).value = value;
      // XÃ³a lá»›p selected-icon cá»§a táº¥t cáº£ icon trong cÃ¹ng nhÃ³m
      var container = element.parentNode;
      Array.prototype.forEach.call(container.children, function(child) {
        child.classList.remove("selected-icon");
      });
      // ThÃªm lá»›p selected-icon cho icon Ä‘Æ°á»£c click
      element.classList.add("selected-icon");
    }
  </script>
</body>
</html>
